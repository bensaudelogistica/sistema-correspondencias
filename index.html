<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sistema de Correspondências - Bensaúde</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js"></script>
    <style>
        body {
            font-family: Arial, sans-serif;
            background: linear-gradient(135deg, #E6F2FF 0%, #F8FAFC 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .login-container {
            max-width: 450px;
            margin: 100px auto;
            background: white;
            border-radius: 24px;
            box-shadow: 0 20px 60px rgba(0, 102, 204, 0.15);
            padding: 50px 40px;
            text-align: center;
        }

        .login-container h1 {
            color: #0066CC;
            margin-bottom: 10px;
            font-size: 2em;
        }

        .login-container p {
            color: #64748B;
            margin-bottom: 30px;
        }

        .form-group {
            margin-bottom: 24px;
            text-align: left;
        }

        .form-group label {
            display: block;
            margin-bottom: 10px;
            font-weight: 600;
            color: #1E293B;
        }

        .form-group input {
            width: 100%;
            padding: 14px 16px;
            border: 2px solid #E2E8F0;
            border-radius: 12px;
            font-size: 1em;
            background: #F8FAFC;
        }

        .form-group input:focus {
            outline: none;
            border-color: #0066CC;
            background: white;
            box-shadow: 0 0 0 4px rgba(0, 102, 204, 0.1);
        }

        .btn-login {
            width: 100%;
            padding: 14px 32px;
            border: none;
            border-radius: 12px;
            font-size: 1em;
            font-weight: 600;
            cursor: pointer;
            background: linear-gradient(135deg, #0066CC 0%, #004C99 100%);
            color: white;
        }

        .btn-login:hover {
            transform: translateY(-3px);
            box-shadow: 0 8px 25px rgba(0, 102, 204, 0.35);
        }

        .alert {
            padding: 16px 20px;
            border-radius: 12px;
            margin-bottom: 24px;
            display: none;
            font-weight: 500;
        }

        .alert-error {
            background: #FEE2E2;
            color: #991B1B;
            border-left: 4px solid #EF4444;
        }

        .loading {
            display: none;
            text-align: center;
            padding: 30px;
        }

        .loading.active {
            display: block;
        }

        .spinner {
            border: 4px solid #E6F2FF;
            border-top: 4px solid #0066CC;
            border-radius: 50%;
            width: 50px;
            height: 50px;
            animation: spin 1s linear infinite;
            margin: 0 auto 15px;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .sistema-principal {
            display: none;
            max-width: 1400px;
            margin: 0 auto;
            background: white;
            border-radius: 24px;
            padding: 40px;
            box-shadow: 0 20px 60px rgba(0, 102, 204, 0.12);
        }

        .header {
            background: linear-gradient(135deg, #0066CC 0%, #004C99 100%);
            color: white;
            padding: 30px;
            border-radius: 16px;
            margin-bottom: 30px;
            text-align: center;
        }

        .header h1 {
            margin: 0;
            font-size: 2em;
        }

        .user-info {
            margin-top: 10px;
            opacity: 0.9;
        }

        .btn-logout {
            margin-top: 20px;
            padding: 10px 20px;
            background: rgba(239, 68, 68, 0.3);
            border: 1px solid rgba(239, 68, 68, 0.5);
            color: white;
            border-radius: 8px;
            cursor: pointer;
        }

        .btn-logout:hover {
            background: rgba(239, 68, 68, 0.5);
        }
    </style>
</head>
<body>
    <!-- TELA DE LOGIN -->
    <div id="telaLogin" class="login-container">
        <h1><i class="fas fa-lock"></i> Login</h1>
        <p>Sistema de Correspondências - Bensaúde</p>
        
        <div class="alert alert-error" id="alertLoginError">
            ❌ Usuário ou senha inválidos
        </div>
        
        <form id="formLogin" onsubmit="fazerLogin(event)">
            <div class="form-group">
                <label><i class="fas fa-user"></i> Usuário:</label>
                <input type="text" id="loginUsuario" required autocomplete="username" placeholder="Digite seu usuário">
            </div>
            <div class="form-group">
                <label><i class="fas fa-key"></i> Senha:</label>
                <input type="password" id="loginSenha" required autocomplete="current-password" placeholder="Digite sua senha">
            </div>
            <button type="submit" class="btn-login">
                <i class="fas fa-sign-in-alt"></i> Entrar
            </button>
        </form>
        
        <div class="loading" id="loadingLogin">
            <div class="spinner"></div>
            <p>Validando credenciais...</p>
        </div>
    </div>

    <!-- SISTEMA PRINCIPAL -->
    <div id="sistemaPrincipal" class="sistema-principal">
        <div class="header">
            <h1><i class="fas fa-box"></i> Sistema de Correspondências</h1>
            <div class="user-info">
                Bem-vindo, <strong id="nomeUsuarioLogado"></strong>
            </div>
            <button class="btn-logout" onclick="fazerLogout()">
                <i class="fas fa-sign-out-alt"></i> Sair
            </button>
        </div>
        
        <div style="text-align: center; padding: 40px;">
            <h2>✅ Sistema Funcionando!</h2>
            <p>Login realizado com sucesso.</p>
            <p>Para ver o sistema completo, precisamos adicionar as outras telas.</p>
        </div>
    </div>

    <script>
        // ⚠️ CRÍTICO: SUBSTITUA PELA URL DO SEU GOOGLE APPS SCRIPT
        const scriptURL = 'https://script.google.com/macros/s/AKfycbzeQZZ9sWj61UPEn-Zpg5r7EIK6XP5ZFcp4ca5ReSP3xBCN6C8UtuNa-sbGfo2AbMHV/exec';
        
        let usuarioLogado = null;

        // Verifica se já existe sessão ao carregar a página
        window.onload = function() {
            console.log('Página carregada!');
            console.log('scriptURL:', scriptURL);
            
            const sessao = localStorage.getItem('sessaoBensaude');
            if (sessao) {
                console.log('Sessão encontrada:', sessao);
                usuarioLogado = JSON.parse(sessao);
                mostrarSistemaPrincipal();
            } else {
                console.log('Nenhuma sessão encontrada, mostrando login');
            }
        };

        async function fazerLogin(e) {
            e.preventDefault();
            
            console.log('Tentando fazer login...');
            
            const login = document.getElementById('loginUsuario').value;
            const senha = document.getElementById('loginSenha').value;
            const loading = document.getElementById('loadingLogin');
            const alertError = document.getElementById('alertLoginError');
            
            console.log('Login:', login);
            console.log('URL do script:', scriptURL);
            
            // Validação básica
            if (scriptURL === 'https://script.google.com/macros/s/AKfycbzeQZZ9sWj61UPEn-Zpg5r7EIK6XP5ZFcp4ca5ReSP3xBCN6C8UtuNa-sbGfo2AbMHV/exec') {
                alert('❌ ERRO: Você precisa substituir a URL do Apps Script no código HTML!\n\nProcure por "COLE_AQUI_A_URL_DO_SEU_APPS_SCRIPT" e substitua pela URL real.');
                return;
            }
            
            loading.classList.add('active');
            alertError.style.display = 'none';
            
            try {
                const url = scriptURL + '?acao=login&login=' + encodeURIComponent(login) + '&senha=' + encodeURIComponent(senha);
                console.log('URL da requisição:', url);
                
                const response = await fetch(url);
                console.log('Resposta recebida:', response);
                
                const result = await response.json();
                console.log('Resultado:', result);
                
                loading.classList.remove('active');
                
                if (result.status === 'success') {
                    console.log('Login bem-sucedido!');
                    usuarioLogado = result.usuario;
                    localStorage.setItem('sessaoBensaude', JSON.stringify(usuarioLogado));
                    mostrarSistemaPrincipal();
                } else {
                    console.log('Erro no login:', result.message);
                    alertError.textContent = '❌ ' + (result.message || 'Usuário ou senha inválidos');
                    alertError.style.display = 'block';
                    setTimeout(function() { 
                        alertError.style.display = 'none'; 
                    }, 5000);
                }
            } catch (error) {
                loading.classList.remove('active');
                console.error('Erro na requisição:', error);
                alertError.textContent = '❌ Erro ao conectar ao servidor: ' + error.message;
                alertError.style.display = 'block';
            }
        }

        function mostrarSistemaPrincipal() {
            console.log('Mostrando sistema principal...');
            document.getElementById('telaLogin').style.display = 'none';
            document.getElementById('sistemaPrincipal').style.display = 'block';
            document.getElementById('nomeUsuarioLogado').textContent = usuarioLogado.nome;
        }

        function fazerLogout() {
            localStorage.removeItem('sessaoBensaude');
            location.reload();
        }

        console.log('Script JavaScript carregado com sucesso!');
    </script>
</body>
</html>



